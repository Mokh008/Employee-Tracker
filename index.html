<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>تسجيل حضور الموظفين</title>
<style>
body {font-family: Arial; display:flex; justify-content:center; align-items:center; height:100vh; background:#f0f2f5; margin:0;}
.card {background:white; padding:30px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.2); width:320px; text-align:center;}
input[type="text"] {padding:10px; width:100%; margin-bottom:20px; border-radius:8px; border:1px solid #ccc; box-sizing:border-box;}
button {width:100%; padding:12px; border:none; border-radius:8px; background:#007bff; color:white; font-weight:bold; cursor:pointer;}
button:hover {background:#0056b3;}
#status {margin-top:20px; font-weight:bold; color:green; white-space:pre-line;}
</style>
</head>
<body>

<div class="card">
<h2>تسجيل حضور الموظفين</h2>
<input id="empId" type="text" placeholder="ادخل رقم ID">
<button onclick="sendLocation()">احصل على موقعى الحالى</button>
<p id="status"></p>
</div>

<script>
function sendLocation() {
    var id = document.getElementById("empId").value;
    if(!id){
        document.getElementById("status").innerText="من فضلك أدخل رقم ID";
        return;
    }

    if(navigator.geolocation){
        // هنا اضفنا enableHighAccuracy للحصول على GPS دقيق
        navigator.geolocation.getCurrentPosition(success,error, { enableHighAccuracy: true });
    } else { alert("المتصفح لا يدعم تحديد الموقع."); }

    function success(pos){
        var lat = pos.coords.latitude;
        var lng = pos.coords.longitude;
        var maps_link = "https://www.google.com/maps?q=" + lat + "," + lng;

        // إرسال البيانات للـ Google Sheet
        fetch("https://script.google.com/macros/s/AKfycbwS_x006x5DDYH5KMPvKgY8gKDcRdmr_H0kwk9Zbh8wg2NPUA8hmvuulTA5AGIyDyu7-g/exec", {
            method: "POST",
            body: new URLSearchParams({
                "id": id,
                "lat": lat,
                "lng": lng,
                "location_link": maps_link
            })
        });

        var now = new Date();
        var date = now.getFullYear() + "-" + (now.getMonth()+1).toString().padStart(2,"0") + "-" + now.getDate().toString().padStart(2,"0");
        var time = now.getHours().toString().padStart(2,"0") + ":" + now.getMinutes().toString().padStart(2,"0") + ":" + now.getSeconds().toString().padStart(2,"0");

        document.getElementById("status").innerText = "تم تسجيل الموقع بنجاح ✔\n"+maps_link+"\n"+date+" "+time;
    }

    function error(){
        alert("تعذر الحصول على الموقع. حاول التأكد من تشغيل GPS وإعطاء الإذن.");
    }
}
</script>

</body>
</html>
