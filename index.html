<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>تسجيل حضور الموظفين</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f2f5;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }
    .card {
        background-color: white;
        padding: 30px 40px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        text-align: center;
        width: 320px;
    }
    .card h2 {
        margin-bottom: 25px;
        color: #333;
    }
    input[type="text"] {
        padding: 10px;
        width: 100%;
        margin-bottom: 20px;
        border-radius: 8px;
        border: 1px solid #ccc;
        box-sizing: border-box;
    }
    button {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        background-color: #007bff;
        color: white;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
    }
    button:hover {
        background-color: #0056b3;
    }
    #status {
        margin-top: 20px;
        font-weight: bold;
        color: green;
        white-space: pre-line;
    }
</style>
</head>

<body>

<div class="card">
    <h2>تسجيل حضور الموظفين</h2>
    <input id="empId" type="text" placeholder="ادخل رقم ID">
    <button onclick="sendLocation()">احصل على موقعى الحالى</button>
    <p id="status"></p>
</div>

<script>
function sendLocation() {

    var id = document.getElementById("empId").value.trim();
    if (!id) {
        document.getElementById("status").innerText = "من فضلك أدخل رقم ID";
        return;
    }

    if (!navigator.geolocation) {
        alert("المتصفح لا يدعم تحديد الموقع.");
        return;
    }

    navigator.geolocation.getCurrentPosition(success, error, {
        enableHighAccuracy: true,
        timeout: 15000,
        maximumAge: 0
    });

    function success(pos) {

        var lat = pos.coords.latitude;
        var lng = pos.coords.longitude;

        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ar`)
        .then(res => res.json())
        .then(data => {

            var addr = data.address || {};

            // القرية / المدينة
            var village =
                addr.village ||
                addr.hamlet ||
                addr.city_district ||
                addr.neighbourhood ||
                addr.town ||
                addr.city ||
                "غير معروف";

            // المركز
            var district =
                addr.county ||
                addr.municipality ||
                addr.city ||
                "غير معروف";

            // المحافظة
            var state =
                addr.state ||
                addr.region ||
                "غير معروف";

            var location = village + " - " + district + " - " + state;

            // إرسال البيانات للـ Google Sheet (URL كما هو)
            fetch("https://script.google.com/macros/s/AKfycbwS_x006x5DDYH5KMPvKgY8gKDcRdmr_H0kwk9Zbh8wg2NPUA8hmvuulTA5AGIyDyu7-g/exec", {
                method: "POST",
                body: new URLSearchParams({
                    id: id,
                    location: location,
                    lat: lat,
                    lng: lng,
                    location_link: "https://www.google.com/maps?q=" + lat + "," + lng
                })
            });

            var now = new Date();
            var date =
                now.getFullYear() + "-" +
                (now.getMonth() + 1).toString().padStart(2, "0") + "-" +
                now.getDate().toString().padStart(2, "0");

            var time =
                now.getHours().toString().padStart(2, "0") + ":" +
                now.getMinutes().toString().padStart(2, "0") + ":" +
                now.getSeconds().toString().padStart(2, "0");

            document.getElementById("status").innerText =
                "تم تسجيل الموقع بنجاح ✔\n" +
                location + "\n" +
                date + " " + time;
        })
        .catch(() => {
            alert("حدث خطأ أثناء تحويل الموقع.");
        });
    }

    function error() {
        alert("تعذر الحصول على الموقع.");
    }
}
</script>

</body>
</html>
